branches:
  only:
    - master

skip_branch_with_pr: false

image:
    #- Visual Studio 2019
    - Ubuntu

platform:
  #- x86
  - x64

configuration:
  - Debug
  #- Release

environment:
    VCPKG_SCRIPT: scripts/buildsystems/vcpkg.cmake
    APPVEYOR_SSH_KEY: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDknu/0miFWqAQLTD5KnaRHwPkKevoYVxr7lJGyv2MRkTx+wOR6AukT4x246OMKmPWOM5StDjy/Ej+FkqVdsPWplxZuo2XBz3SxVcH3GMENnZ/YHGeesi1Bs46s7f8qApt0tJ5tPggqxVBP65xilj/oQSRRau/pdKLDzJzwC+Lb5Q2Df75oRhNImQCg4FJpGEf0cecTo+czEV/H3IXz9mUvFF8wOnCHy/J0Y+LGYvsCndtvSG3Y+5GzQOa0SYPvINkuJOcd6a3e0bZThJoTyj08qsNfWcI7L4Way1/58JJddhJWQ529RYYw5Xpmj7XfplGM5Y+ukQM/XIObqQjNyyT1+/PuCCSPkFraqsyqpCywPFw9osh/Q70aQAZHk2GEzxcLB7e3nmY//TvzR+luklBNlKV2ciR3J+V1Ln5rIR+wyyPe8aVRkU+nQ14lpbA3NvmMaCZGLbudmslY++0sgsZyeMo4UaDavAztO6XECeF5/dtv+RE/P3Hoh71dJURlvMc= raffa@localhost.localdomain
 # remove
matrix:
    allow_failures:
        - platform: x86
          image: Ubuntu

for:
-
    matrix:
        only:
            - image: Ubuntu
    cache: /home/appveyor/vcpkg


  
init:
    - sh: if [ $PLATFORM = "x86" ]; then exit 1; fi
    - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e - #remove

    # remove below after
on_finish:
  - sh: export APPVEYOR_SSH_BLOCK=true
  - sh: curl -sflL 'https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-ssh.sh' | bash -e -

install:
    - cmd: if "%PLATFORM%" == "x64" call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
    - cmd: if "%PLATFORM%" == "x86" call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars32.bat"
    - ninja --version

before_build:
    - cmd: cd C:\tools\vcpkg
    - sh: cd /home/appveyor/vcpkg
    - git pull
    - cmd: .\bootstrap-vcpkg.bat
    - sh: ./bootstrap-vcpkg.sh
    - cmd: vcpkg install sdl2 sdl2-image gtest --triplet %PLATFORM%-windows    
    - sh: vcpkg install sdl2 sdl2-image gtest --triplet $PLATFORM-linux
    - vcpkg integrate install
    - cmd: cd %APPVEYOR_BUILD_FOLDER%
    - sh: cd $APPVEYOR_BUILD_FOLDER

cache: C:\tools\vcpkg\

build_script:
    - mkdir out
    - cd out
    
    - sh: ls /home/appveyor/vcpkg/scripts/buildsystems/
    - sh: ls /home/appveyor/vcpkg/scripts/
    - sh: ls /home/appveyor/vcpkg/
    - sh: ls /home/appveyor/


    - cmd : cmake -G "Ninja" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/%VCPKG_SCRIPT% ..
    - sh : cmake -G "Ninja" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DCMAKE_TOOLCHAIN_FILE=-DCMAKE_TOOLCHAIN_FILE=/home/appveyor/vcpkg/scripts/buildsystems/vcpkg.cmake ..

test_script:
    - cmake --build .
    - ctest -V
    - cmake -P cmake_install.cmake
