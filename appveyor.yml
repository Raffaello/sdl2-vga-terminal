# branches to build
branches:
  # whitelist
  only:
    - master

skip_branch_with_pr: false

image:
    - Visual Studio 2019
    - Ubuntu

platform:
  - x86
  - x64

configuration:
  - Debug
  - Release

environment:
    VCPKG_SCRIPT: scripts/buildsystems/vcpkg.cmake
    #INIT_VS: vcvars32.bat
    #BUILD_CMAKE: Win32

for:
-
    matrix:
        only:
            - platform: x64
            - image: Visual Studio 2019
    environment:
        INIT_VS: vcvars64.bat
-
    matrix:
        only:
            - platform: x86
            - image: Visual Studio 2019
    environment:
        INIT_VS: vcvars32.bat
-
    matrix:
        only:
            - image: Visual Studio 2019
    environment:
        VCPKG_ROOT: c:/tools/vcpkg
    install:
        - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\%INIT_VS%"
        - cd C:\tools\vcpkg
        - git pull
        - .\bootstrap-vcpkg.bat
    before_build:                
        - vcpkg install sdl2 sdl2-image gtest --triplet %PLATFORM%-windows
        - vcpkg integrate install
        - cd %APPVEYOR_BUILD_FOLDER%
    cache: 
        - c:/tools/vcpkg
    
-
    matrix:
        only:
            - image: Ubuntu
    environment:
        VCPKG_ROOT: /home/vcpkg
    before_build:
        - pwd
        - cd /home
        - git clone https://github.com/Microsoft/vcpkg.git && cd vcpkg
        - pwd
        - ./bootstrap-vcpkg.sh
        - vcpkg install sdl2 sdl2-image gtest --triplet %PLATFORM%-linux
        - vcpkg integrate install
        - cd %APPVEYOR_BUILD_FOLDER%
    cache:
        - /home/vcpkg

init:
    - ninja --version



build_script:
    - mkdir out
    - cd out
    - cmake -G "Ninja" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DCMAKE_TOOLCHAIN_FILE=%VCPKG_ROOT%/%VCPKG_SCRIPT%" ..

test_script:
    - cmake --build .
    - ctest -V
    - cmake -P cmake_install.cmake
