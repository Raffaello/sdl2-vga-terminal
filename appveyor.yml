branches:
  only:
    - master

#skip_branch_with_pr: false

image: Visual Studio 2019
#    - Ubuntu

platform:
  - x86
  - x64

configuration:
  - Debug
  - Release

environment:
    VCPKG_SCRIPT: scripts/buildsystems/vcpkg.cmake

install:
    - cmd: if %PLATFORM% == "x64" call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
    - cmd: if %PLATFORM% == "x86" call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars32.bat"
    - ninja --version
    
before_build:
    - cmd: cd C:\tools\vcpkg
 #   - sh: cd /home && git clone https://github.com/Microsoft/vcpkg.git && cd vcpkg
    - git pull
    - cmd: .\bootstrap-vcpkg.bat
 #   - sh: ./bootstrap-vcpkg.bat
    - vcpkg install sdl2 sdl2-image gtest --triplet %PLATFORM%-windows    
    - vcpkg integrate install
    - cd %APPVEYOR_BUILD_FOLDER%


#cache: 
#    - cmd: C:\tools\vcpkg\
#    - sh: /home/vcpkg

build_script:
    - mkdir out
    - cd out
    - cmd : cmake -G "Ninja" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/%VCPKG_SCRIPT% ..
#    - sh : cmake -G "Ninja" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DCMAKE_TOOLCHAIN_FILE=/home/vcpkg/%VCPKG_SCRIPT% ..

test_script:
    - cmake --build .
    - ctest -V
    - cmake -P cmake_install.cmake
